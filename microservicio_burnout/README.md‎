# Microservicio de Burnout

## ðŸ“‹ DescripciÃ³n

Microservicio completo para anÃ¡lisis y prevenciÃ³n de burnout que integra:
- **PredicciÃ³n de burnout** mediante Machine Learning (Gradient Boosting)
- **Sistema de alertas** automÃ¡tico basado en umbrales
- **Dashboard** con resumen completo del estado del empleado
- **GeneraciÃ³n de intervenciones** personalizadas

## ðŸ—ï¸ Arquitectura

```
microservicio_burnout/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                      # API FastAPI principal
â”‚   â”œâ”€â”€ burnout_model.py             # Modelo ML para predicciÃ³n
â”‚   â”œâ”€â”€ AlertsService/               # Servicio de generaciÃ³n de alertas
â”‚   â”œâ”€â”€ DashboardService/            # Servicio de resumen y dashboard
â”‚   â”œâ”€â”€ InterventionService/         # Servicio de intervenciones
â”‚   â””â”€â”€ clients/                     # Cliente HTTP para cms-backend
â”œâ”€â”€ models/
â”‚   â””â”€â”€ burnout_model.pkl            # Modelo ML entrenado
â”œâ”€â”€ requirements.txt                 # Dependencias Python
â”œâ”€â”€ Dockerfile                       # Imagen Docker
â”œâ”€â”€ README.md                        # Este archivo
â””â”€â”€ ARCHITECTURE.md                  # DocumentaciÃ³n tÃ©cnica detallada
```

## âœ¨ CaracterÃ­sticas Principales

### 1. AlertsService
- Detecta riesgo de burnout cuando probabilidad > 0.5
- Clasifica severidad: low, medium, high, critical
- Identifica factores contribuyentes especÃ­ficos
- Genera acciones inmediatas recomendadas
- Determina necesidad de notificaciÃ³n a supervisor

### 2. DashboardService
- Resumen completo del estado del empleado
- AnÃ¡lisis de 6+ mÃ©tricas clave
- Scores por 4 categorÃ­as (fisiolÃ³gico, cognitivo, bienestar, carga laboral)
- IdentificaciÃ³n de top 5 causas principales
- Recomendaciones personalizadas

### 3. InterventionService
- 40+ intervenciones especÃ­ficas implementadas
- OrganizaciÃ³n por timeframe (inmediato, corto, medio, largo plazo)
- ClasificaciÃ³n por prioridad (crÃ­tica, alta, media, baja)
- Plan de acciÃ³n en 4 fases con criterios de Ã©xito
- Seguimiento y resultados esperados

### 4. MetricsClient
- IntegraciÃ³n con cms-backend/src/modules/metrics
- AutenticaciÃ³n JWT
- TransformaciÃ³n automÃ¡tica de datos
- Fallback a mÃ©tricas por defecto en caso de error

## ðŸš€ InstalaciÃ³n y Despliegue

### Requisitos Previos
- Python 3.9+
- Docker (opcional, recomendado)

### OpciÃ³n 1: Docker (Recomendado)

```bash
# Construir la imagen
docker build -t microservicio-burnout .

# Ejecutar el contenedor
docker run -d \
  -p 8001:8001 \
  -e CMS_BACKEND_URL=http://cms-backend:3000 \
  --name burnout-service \
  microservicio-burnout
```

### OpciÃ³n 2: Docker Compose

Agregar al `docker-compose.yml` del proyecto:

```yaml
services:
  microservicio-burnout:
    build: ./microservicio_burnout
    container_name: burnout-service
    ports:
      - "8001:8001"
    environment:
      - CMS_BACKEND_URL=http://cms-backend:3000
    depends_on:
      - cms-backend
    networks:
      - vision-network
    restart: unless-stopped
```

Luego ejecutar:

```bash
docker-compose up -d microservicio-burnout
```

### OpciÃ³n 3: EjecuciÃ³n Local

```bash
# Instalar dependencias
cd microservicio_burnout
pip install -r requirements.txt

# Iniciar el servicio
python -m uvicorn app.main:app --host 0.0.0.0 --port 8001
```

## ðŸŒ API Endpoints

### InformaciÃ³n y Salud
```
GET  /                           # InformaciÃ³n del microservicio
GET  /api/burnout/health         # Estado de salud del servicio
```

### GestiÃ³n del Modelo
```
POST /api/burnout/train          # Entrenar modelo (si tienes datos)
POST /api/burnout/load-model     # Cargar/recargar modelo manualmente
GET  /api/burnout/metrics        # MÃ©tricas del modelo ML
```

### PredicciÃ³n BÃ¡sica
```
GET  /api/burnout/predict/{id}   # PredicciÃ³n simple de burnout
POST /api/burnout/predict/{id}   # PredicciÃ³n con datos personalizados
```

### AnÃ¡lisis Completo
```
GET  /api/burnout/analyze/{id}          # AnÃ¡lisis completo integrado
GET  /api/burnout/alerts/{id}           # Solo generaciÃ³n de alertas
GET  /api/burnout/dashboard/{id}        # Solo resumen de dashboard
GET  /api/burnout/interventions/{id}    # Solo plan de intervenciones
POST /api/burnout/analyze-custom        # AnÃ¡lisis con mÃ©tricas manuales
```

## ðŸ“Š Uso del API

### Ejemplo: AnÃ¡lisis Completo

```bash
curl -X GET "http://localhost:8001/api/burnout/analyze/123" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Respuesta:**
```json
{
  "user_id": 123,
  "generated_at": "2025-11-01T10:30:00",
  "prediction": {
    "burnout_probability": 0.65,
    "burnout_prediction": 1,
    "burnout_level": "moderate",
    "risk_category": "Riesgo Moderado"
  },
  "alert": {
    "alert_id": "ALERT-123-20251101103000",
    "severity": "medium",
    "message": "âš ï¸ ALERTA MEDIA: ...",
    "immediate_actions": [...],
    "contributing_factors": [...]
  },
  "summary": {
    "overview": {...},
    "key_metrics": [...],
    "category_scores": {...},
    "main_causes": [...]
  },
  "interventions": {
    "total_interventions": 12,
    "interventions_by_timeframe": {...},
    "action_plan": {...}
  }
}
```

### Ejemplo: Solo Alertas

```bash
curl -X GET "http://localhost:8001/api/burnout/alerts/123" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### Ejemplo: Con MÃ©tricas Personalizadas

```bash
curl -X POST "http://localhost:8001/api/burnout/analyze-custom?user_id=123" \
  -H "Content-Type: application/json" \
  -d '{
    "time_to_recover": 40.0,
    "high_stress_prevalence_perc": 30.0,
    "median_hrv": 35.0,
    "avg_pulse": 80.0,
    "sleep_score": 60.0,
    "media_hrv": 35.0,
    "eda_peaks": 18.0,
    "time_to_recover_hrv": 40.0,
    "weekly_hours_in_meetings": 28.0,
    "time_on_focus_blocks": 3.0,
    "absenteesim_days": 1.5,
    "high_stress_prevalence": 0.30,
    "nps_score": 6.5,
    "intervention_acceptance_rate": 0.45
  }'
```

## ðŸ”— IntegraciÃ³n con el Proyecto

### Desde el Frontend (Next.js)

```typescript
// lib/burnoutClient.ts
import axios from 'axios';

const burnoutClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_BURNOUT_URL || 'http://localhost:8001',
});

export async function getBurnoutAnalysis(userId: number) {
  const response = await burnoutClient.get(`/api/burnout/analyze/${userId}`);
  return response.data;
}
```

### Desde el CMS Backend (NestJS)

```typescript
// burnout.service.ts
import { HttpService } from '@nestjs/axios';

@Injectable()
export class BurnoutService {
  constructor(private readonly httpService: HttpService) {}

  async getAnalysis(userId: number) {
    const url = `${process.env.BURNOUT_SERVICE_URL}/api/burnout/analyze/${userId}`;
    const response = await firstValueFrom(this.httpService.get(url));
    return response.data;
  }
}
```

## âš™ï¸ Variables de Entorno

| Variable | DescripciÃ³n | Default |
|----------|-------------|---------|
| `CMS_BACKEND_URL` | URL del cms-backend para obtener mÃ©tricas | `http://cms-backend:3000` |

## ðŸ“ˆ MÃ©tricas Requeridas

El servicio espera 14 mÃ©tricas del usuario:

### MÃ©tricas FisiolÃ³gicas
- `median_hrv` - Variabilidad cardÃ­aca mediana (ms)
- `avg_pulse` - Pulso promedio (bpm)
- `sleep_score` - PuntuaciÃ³n de calidad del sueÃ±o (0-100)
- `time_to_recover` - Tiempo de recuperaciÃ³n (minutos)
- `eda_peaks` - Picos de actividad electrodÃ©rmica

### MÃ©tricas de EstrÃ©s
- `high_stress_prevalence_perc` - Porcentaje de tiempo en estrÃ©s alto
- `high_stress_prevalence` - Prevalencia de estrÃ©s alto (0-1)

### MÃ©tricas de Trabajo
- `weekly_hours_in_meetings` - Horas semanales en reuniones
- `time_on_focus_blocks` - Tiempo diario en bloques de enfoque (horas)
- `absenteesim_days` - DÃ­as de ausentismo

### MÃ©tricas de SatisfacciÃ³n
- `nps_score` - Net Promoter Score (0-10)
- `intervention_acceptance_rate` - Tasa de aceptaciÃ³n de intervenciones (0-1)

## ðŸ“– DocumentaciÃ³n

- **API Interactiva**: `http://localhost:8001/docs` (Swagger UI)
- **DocumentaciÃ³n Alternativa**: `http://localhost:8001/redoc`
- **Arquitectura Detallada**: Ver [ARCHITECTURE.md](ARCHITECTURE.md)

## ðŸ”’ Seguridad

- AutenticaciÃ³n mediante JWT tokens
- ValidaciÃ³n de entrada con Pydantic
- Headers CORS configurables
- Sin almacenamiento de datos sensibles

## ðŸ› SoluciÃ³n de Problemas

### Error: "Modelo no disponible"
**SoluciÃ³n**: Cargar el modelo manualmente:
```bash
curl -X POST "http://localhost:8001/api/burnout/load-model"
```

### Error de conexiÃ³n con cms-backend
**SoluciÃ³n**: Verificar:
1. Que cms-backend estÃ¡ corriendo
2. La variable de entorno `CMS_BACKEND_URL`
3. El servicio continuarÃ¡ funcionando con mÃ©tricas por defecto

### Servicio no inicia
**SoluciÃ³n**: Verificar:
```bash
# Ver logs del contenedor
docker logs burnout-service

# Verificar que el puerto 8001 estÃ¡ disponible
netstat -an | grep 8001
```

## ðŸ“Š Flujo de AnÃ¡lisis

```
Usuario (ID) â”€â”€â–º GET /api/burnout/analyze/{user_id}
                        â”‚
                        â–¼
                  MetricsClient
                  Obtener mÃ©tricas del cms-backend
                        â”‚
                        â–¼
                  BurnoutPredictor
                  Predecir probabilidad de burnout
                        â”‚
                        â–¼
                  AlertsService
                  Â¿Probabilidad > 0.5? â†’ Generar alerta
                        â”‚
                        â–¼
                  DashboardService
                  Analizar estado completo
                  - Calcular scores
                  - Identificar causas
                        â”‚
                        â–¼
                  InterventionService
                  Generar plan de intervenciones
                  - Basado en causas principales
                  - Organizado por prioridad
                        â”‚
                        â–¼
                  Respuesta JSON Completa
```

## ðŸŽ¯ Rendimiento

- PredicciÃ³n de burnout: < 100ms
- AnÃ¡lisis completo: < 500ms (sin latencia de red)
- Soporte para mÃºltiples requests concurrentes
- Cache de modelo ML en memoria

## ðŸ“ Notas de VersiÃ³n

### VersiÃ³n 2.0.0 (Actual)
- âœ… Sistema modular con 3 servicios especializados
- âœ… IntegraciÃ³n con cms-backend
- âœ… Sistema de alertas automÃ¡tico
- âœ… Dashboard completo
- âœ… 40+ intervenciones personalizadas
- âœ… Listo para producciÃ³n

## ðŸ“„ Licencia

Proyecto acadÃ©mico - Universidad

## ðŸ‘¥ Soporte

Para consultas o problemas:
1. Revisar la documentaciÃ³n en [ARCHITECTURE.md](ARCHITECTURE.md)
2. Consultar la API interactiva en `/docs`
3. Contactar al equipo de desarrollo

---

**Estado**: âœ… ProducciÃ³n  
**VersiÃ³n**: 2.0.0  
**Ãšltima actualizaciÃ³n**: Noviembre 2025